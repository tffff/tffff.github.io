(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[42],{vgUs:function(e,n,a){"use strict";a.r(n);var l=a("q1tI"),t=a.n(l),i=a("dEAq"),c=a("H1Ra"),r=t.a.memo((e=>{e.demos;return t.a.createElement(t.a.Fragment,null,t.a.createElement("div",{className:"markdown"},t.a.createElement("h1",{id:"gitlab-cicd"},t.a.createElement(i["AnchorLink"],{to:"#gitlab-cicd","aria-hidden":"true",tabIndex:-1},t.a.createElement("span",{className:"icon icon-link"})),"gitlab CI/CD"),t.a.createElement("p",null,"gitlab \u7f51\u7ad9\u91cc\u9762\u6211\u4eec\u770b\u5230\u6709 CI/CD \u7684\u6253\u5305\u6d41\u7a0b\uff0c\u4f46\u662f\u6211\u4eec\u90fd\u4e0d\u77e5\u9053\u5230\u5e95\u662f\u600e\u4e48\u914d\u7f6e\u7684\uff0c\u4e0b\u9762\u6211\u4eec\u5c31\u6765\u770b\u4e00\u4e0b",t.a.createElement("code",null,".gitlab-ci.yml"),"\u6587\u4ef6\u662f\u600e\u4e48\u7f16\u5199\u7684\u3002"),t.a.createElement("h2",{id:"gitlab-ciyml-\u653e\u5728\u54ea\u91cc"},t.a.createElement(i["AnchorLink"],{to:"#gitlab-ciyml-\u653e\u5728\u54ea\u91cc","aria-hidden":"true",tabIndex:-1},t.a.createElement("span",{className:"icon icon-link"})),".gitlab-ci.yml \u653e\u5728\u54ea\u91cc\uff1f"),t.a.createElement("p",null,t.a.createElement("code",null,".gitlab-ci.yml"),"\u4e3b\u8981\u662f\u653e\u5728\u9879\u76ee\u7684\u6839\u76ee\u5f55\u4e0b\u9762"),t.a.createElement("h2",{id:"gitlab-ciyml-\u5e38\u7528\u7684\u6b65\u9aa4"},t.a.createElement(i["AnchorLink"],{to:"#gitlab-ciyml-\u5e38\u7528\u7684\u6b65\u9aa4","aria-hidden":"true",tabIndex:-1},t.a.createElement("span",{className:"icon icon-link"})),".gitlab-ci.yml \u5e38\u7528\u7684\u6b65\u9aa4"),t.a.createElement("p",null,"\u4e0b\u9762\u662f\u4e00\u4e2a\u9879\u76ee\u91cc\u9762",t.a.createElement("code",null,".gitlab-ci.yml"),"\u7684\u6b65\u9aa4\uff0c\u6211\u4eec\u6765\u770b\u4e00\u4e0b\u90fd\u662f\u4ec0\u4e48\u610f\u601d\uff1f"),t.a.createElement(c["a"],{code:"variables:  //\u5b9a\u4e49\u6784\u5efa\u53d8\u91cf\n  TARGET_REPO: \"\"\n\nbefore_script: //\u8fd9\u4e2a\u662f\u6267\u884c\u6bcf\u4e2ajob\u4e4b\u524d\u9700\u8981\u6267\u884c\u7684\u811a\u672c\uff0c\n  - chcp 65001  //\u8bbe\u7f6ecmd\u683c\u5f0f\uff0c\u6570\u5b5765001\u4ee3\u8868\u7684\u662fcmd\u7a97\u53e3\u4e2dutf-8\u683c\u5f0f\u7684\u7f16\u7801\n  - 'git config core.autocrlf false'\n\nstages:  //\u5b9a\u4e49\u811a\u672c\u6709\u591a\u5c11\u9636\u6bb5(\u4e13\u4e1a\u70b9\u53ebjob)\uff0c\u8fd9\u91cc\u6709\u4e09\u4e2ajob,\u6bcf\u4e2ajob\u90fd\u8981\u7528-\u5f00\u5934\u6362\u884c\n  - install\n  - package\n  - push\n\ninstall: //\u8fd9\u91cc\u5c31\u5f00\u59cb\u5de5\u4f5c\u4e86\n  stage: install  //\u8fd9\u91cc\u5bf9\u5e94\u7684\u662f\u4e0a\u9762\u7684stagets\u7684install\uff0c\u4e00\u5b9a\u8981\u4e00\u81f4\n  script:    //\u6267\u884c\u547d\u4ee4\uff0c\u8fd9\u4e9b\u547d\u4ee4\u90fd\u662f\u540c\u6b65\u7684\n  - npm run init\n  cache: //\u91cd\u590d\u8fd0\u884c\u7684\u65f6\u5019\u4e0d\u8981\u91cd\u590d\u5b89\u88c5\u5168\u90e8node_modules\u7684\u5305\uff0c1\u3001\u5728\u4e0d\u540cpipeline\u4e4b\u95f4\u91cd\u7528\u8d44\u6e90\uff0c2\u3001\u5728\u540c\u4e00pipeline\u7684\u4e0d\u540cJob\u4e4b\u95f4\u91cd\u7528\u8d44\u6e90\n    key: ${CI_COMMIT_REF_SLUG}\n    paths:\n    - node_modules/\n  only:  //\u8868\u793a\u4ec5\u5728dev/master\u5206\u652f\u4e0a\u6267\u884c\n    refs:\n      - dev\n      - master\n    variables:\n        - $NPM_INSTALL == \"true\"\n  when: manual   //\u5b9a\u4e49job\u4ec0\u4e48\u65f6\u5019\u80fd\u88ab\u6267\u884c,on_success,on_failure,always\u6216\u8005manual\n\npackage:\n  stage: package\n  script:\n  - echo \"${CI_PROJECT_DIR}\"\n  - npm run build:micro --releasepath=../CivWebPublish2021\n  cache:\n    key: ${CI_COMMIT_REF_SLUG}\n    paths:\n    - node_modules/\n  only:\n    refs:\n      - dev\n      - master\n  when: manual\n\n\npush:\n  variables:\n    GIT_STRATEGY: none\n  stage: push\n  script:\n  - 'cd \"${TARGET_REPO}\"'\n  - 'git reset --hard head'\n  - 'git clean -fd'\n  - 'git remote set-url origin \"https://${ACCESS_USER}:${ACCESS_PASSWORD}@g.civnet.cn:8443/CivPublish/CivWebPublish2021.git\"'\n  - 'git pull origin map'\n  - 'git rm -rf \"${TARGET_REPO}/civ_water\"'\n  - 'git commit -m \"chore: clear folder\"'\n  - 'git push origin map'\n  - 'robocopy \"${CI_PROJECT_DIR}/../CivWebPublish2021/civ_water\" \"${TARGET_REPO}/civ_water\" /S ;\n        IF ((${LASTEXITCODE} -le 8)) {cmd /c \"exit /b 0\"}'\n  - 'git add . ; git reset HEAD Web.config CityInterface/Web.config CityWebFW/Web.config ; git commit -m \"auto package civ_water.\"'\n  - 'git push origin map'\n  only:\n    refs:\n      - dev\n      - master\n  when: manual",lang:"js"}),t.a.createElement("p",null,"when \u7684\u51e0\u4e2a\u503c\uff1a"),t.a.createElement("ul",null,t.a.createElement("li",null,t.a.createElement("code",null,"on_success")," \u53ea\u6709\u5728\u4e4b\u524d\u573a\u666f\u6267\u884c\u7684\u6240\u6709\u4f5c\u4e1a\u6210\u529f\u7684\u65f6\u5019\u624d\u6267\u884c\u5f53\u524d job\uff0c\u8fd9\u4e2a\u5c31\u662f\u9ed8\u8ba4\u503c\uff0c\u6211\u4eec\u7528\u6700\u5c0f\u914d\u7f6e\u7684\u65f6\u5019\u4ed6\u9ed8\u8ba4\u5c31\u662f\u8fd9\u4e2a\u503c\uff0c\u6240\u4ee5\u5931\u8d25\u7684\u65f6\u5019 pipeline \u4f1a\u505c\u6b62\u6267\u884c\u540e\u7eed\u4efb\u52a1"),t.a.createElement("li",null,t.a.createElement("code",null,"on_failure")," \u53ea\u6709\u5728\u4e4b\u524d\u573a\u666f\u6267\u884c\u7684\u4efb\u52a1\u4e2d\u81f3\u5c11\u6709\u4e00\u4e2a\u5931\u8d25\u7684\u65f6\u5019\u624d\u6267\u884c"),t.a.createElement("li",null,t.a.createElement("code",null,"always")," \u4e0d\u7ba1\u4e4b\u524d\u573a\u666f\u9636\u6bb5\u7684\u72b6\u6001\uff0c\u603b\u662f\u6267\u884c"),t.a.createElement("li",null,t.a.createElement("code",null,"manual")," ~\u624b\u52a8\u6267\u884c job \u7684\u65f6\u5019\u89e6\u53d1"))))}));n["default"]=e=>{var n=t.a.useContext(i["context"]),a=n.demos;return t.a.useEffect((()=>{var n;null!==e&&void 0!==e&&null!==(n=e.location)&&void 0!==n&&n.hash&&i["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),t.a.createElement(r,{demos:a})}}}]);